name: Sync Private Repo

on:
  schedule:
    - cron: "0 */6 * * *"
  workflow_dispatch:

jobs:
  sync-private-repo:
    runs-on: ubuntu-latest

    env:
      DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
      DISCORD_CLIENT_ID: ${{ secrets.DISCORD_CLIENT_ID }}
      CHAT_CHANNEL_ID: ${{ secrets.CHAT_CHANNEL_ID }}
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      OPENAI_BASE_URL: ${{ secrets.OPENAI_BASE_URL }}
      OPENAI_MODEL: ${{ secrets.OPENAI_MODEL }}
      OPENAI_TEMPERATURE: ${{ secrets.OPENAI_TEMPERATURE }}
      OPENAI_TOP_P: ${{ secrets.OPENAI_TOP_P }}
      OPENAI_MAX_TOKENS: ${{ secrets.OPENAI_MAX_TOKENS }}
      OPENAI_QUEUE_CONCURRENCY: ${{ secrets.OPENAI_QUEUE_CONCURRENCY }}
      OPENAI_MIN_INTERVAL_MS: ${{ secrets.OPENAI_MIN_INTERVAL_MS }}
      LOG_LEVEL: ${{ secrets.LOG_LEVEL }}

    steps:
      - name: Checkout Public Repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Clone Private Repo
        run: |
          git clone https://x-access-token:${{ secrets.PRIVATE_REPO_TOKEN }}@github.com/${{ secrets.PRIVATE_REPO_OWNER }}/selfbot.git private-repo

      - name: Run Private Repo Bot
        run: |
          cd private-repo
          npm install --production
          timeout 21540 node . || true
